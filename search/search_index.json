{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Flow BT","text":"<p>A Python client library for interacting with Flow 2 air quality monitors via Bluetooth Low Energy (BLE).</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Async/await API using <code>asyncio</code> and <code>bleak</code></li> <li>Live data streaming - Real-time PM2.5 readings</li> <li>Historical data fetch - Retrieve stored sensor measurements</li> <li>Type hints - Full type annotations for better IDE support</li> <li>Well documented - Comprehensive docstrings and examples</li> <li>CLI Tool - Built-in command line interface for discovery and quick testing</li> </ul>"},{"location":"#installation","title":"Installation","text":"<pre><code>pip install flow-bt\n</code></pre>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code>import asyncio\nfrom flow_bt import Flow2Client\n\nasync def main():\n    client = Flow2Client(\"YOUR_DEVICE_ADDRESS\")\n\n    def on_data(msg_type, payload):\n        if msg_type == \"live\":\n            print(f\"PM2.5: {payload:.2f} \u00b5g/m\u00b3\")\n\n    await client.connect()\n    await client.start_stream(on_data)\n    await asyncio.sleep(10)\n    await client.disconnect()\n\nasyncio.run(main())\n</code></pre> <p>See Examples for more details.</p>"},{"location":"PROTOCOL_REPORT/","title":"Flow 2 BLE Protocol Analysis","text":""},{"location":"PROTOCOL_REPORT/#overview","title":"Overview","text":"<p>This document details the reverse-engineered BLE protocol for the Flow 2 air quality monitor, based on trace analysis and live verification.</p>"},{"location":"PROTOCOL_REPORT/#connection-details","title":"Connection Details","text":"<ul> <li>Device Name: <code>FLOW-XX:XX:XX</code> (e.g., <code>FLOW-00:43:A6</code>)</li> <li>Service UUID: <code>30390100-4e55-4c10-9dce-b654f35fdf99</code> (Flow Service)</li> </ul>"},{"location":"PROTOCOL_REPORT/#characteristics","title":"Characteristics","text":"UUID Description Properties <code>30390201-4e55-4c10-9dce-b654f35fdf99</code> Authentication Write <code>30390101-4e55-4c10-9dce-b654f35fdf99</code> Command / Control Write, Indicate <code>30390102-4e55-4c10-9dce-b654f35fdf99</code> Data Stream Notify"},{"location":"PROTOCOL_REPORT/#authentication-flow","title":"Authentication Flow","text":"<p>Before sending commands or receiving data, the client must authenticate.</p> <ol> <li>Connect to the device.</li> <li>Write the 8-byte key to <code>UUID_AUTH</code> (<code>30390201...</code>).</li> <li>Key: <code>0xa5 0x97 0x14 0x69 0x30 0xb0 0x13 0x03</code></li> </ol>"},{"location":"PROTOCOL_REPORT/#commands","title":"Commands","text":""},{"location":"PROTOCOL_REPORT/#activation-live-data","title":"Activation (Live Data)","text":"<p>Enables sensor readings and live data streaming.</p> <ul> <li>Char: <code>UUID_COMMAND</code> (<code>30390101...</code>)</li> <li>Command: <code>0x02</code></li> <li>Response (Indication): <code>01 02 00 80 10 00 00</code> (Status OK)</li> </ul>"},{"location":"PROTOCOL_REPORT/#fetch-history","title":"Fetch History","text":"<p>Triggers the download of stored history data.</p> <ul> <li>Char: <code>UUID_COMMAND</code> (<code>30390101...</code>)</li> <li>Command: <code>01 05 00</code></li> <li>Behavior: Device sends a sequence of large notifications on <code>UUID_DATA</code>.</li> </ul>"},{"location":"PROTOCOL_REPORT/#data-format","title":"Data Format","text":""},{"location":"PROTOCOL_REPORT/#live-data-packet-notify","title":"Live Data Packet (Notify)","text":"<ul> <li>Size: 20 bytes</li> <li>Structure:</li> <li><code>Header</code>: 8 bytes</li> <li><code>PM Value</code>: Float (Little Endian) at offset 8 (<code>data[8:12]</code>)</li> <li><code>Other</code>: 8 bytes</li> </ul>"},{"location":"PROTOCOL_REPORT/#history-data-packet-notify","title":"History Data Packet (Notify)","text":"<ul> <li>Size: 244 bytes (typically)</li> <li>Structure:</li> <li>Header: 1 byte (packet sequence/type?)</li> <li>Payload: Array of records.</li> <li>Record Structure:</li> <li>Size: ~13 bytes (variable padding observed)</li> <li>Timestamp: 4 bytes (Little Endian, Unix Epoch) at offset 0.</li> <li>Data: ~9 bytes usually following timestamp.</li> <li>Periodicity: Records appear every 13 bytes, with occasional 15-byte or larger gaps (suggesting variable length or stuffing).</li> </ul>"},{"location":"PROTOCOL_REPORT/#example-history-decoding","title":"Example History Decoding","text":"<p>From trace data:</p> <ul> <li>Packet: <code>02 f8 86 14 69 ...</code></li> <li>Record 0: <code>f8 86 14 69</code> -&gt; TS <code>1762952952</code> (2025-11-12 13:09:12)</li> <li>Record 1 (Offset 14): <code>08 86 14 69</code> -&gt; TS <code>1762952712</code> (2025-11-12 13:05:12) (Delta -4 mins? Order might be LIFO or FIFO).</li> </ul>"},{"location":"PROTOCOL_REPORT/#python-implementation","title":"Python Implementation","text":"<p>See <code>flow2_client.py</code> for the reference implementation of the connection and fetch sequence.</p>"},{"location":"WALKTHROUGH/","title":"Protocol Reverse Engineering Walkthrough","text":""},{"location":"WALKTHROUGH/#goal","title":"Goal","text":"<p>Reverse engineer the extended BLE protocol for the Flow 2 device to enable history data extraction.</p>"},{"location":"WALKTHROUGH/#steps-taken","title":"Steps Taken","text":""},{"location":"WALKTHROUGH/#1-device-identification","title":"1. Device Identification","text":"<ul> <li>Used <code>scan_all.py</code> to identify the device.</li> <li>Result: Device <code>FLOW-00:43:A6</code> (<code>E4:3D:7F:05:7C:FA</code>) found.</li> <li>Service UUID: <code>30390100-4e55-4c10-9dce-b654f35fdf99</code>.</li> </ul>"},{"location":"WALKTHROUGH/#2-protocol-analysis-csv-extraction","title":"2. Protocol Analysis (CSV Extraction)","text":"<ul> <li>Ran <code>packet_parser.py</code> (previous turn) to extract BLE packets from capture.</li> <li>Result: <code>flow2_filtered_data.csv</code> generated.</li> <li>Findings:</li> <li>Auth: <code>30390401...</code> access.</li> <li>Command: <code>30390101...</code> (Write <code>02</code> for Activate, <code>010500</code> for Fetch).</li> <li>Data: <code>30390102...</code> (Bulk notifications).</li> </ul>"},{"location":"WALKTHROUGH/#3-verification-live","title":"3. Verification (Live)","text":"<ul> <li>Created <code>data_explorer.py</code> to test the sequence: <code>Auth -&gt; Subscribe -&gt; Activate -&gt; Fetch</code>.</li> <li>Result:</li> <li>Authenticated successfully.</li> <li>Received Indication <code>01 02 00 80 10 00 00</code> after sending <code>02</code> (Activate).</li> <li>Sent <code>01 05 00</code> (Fetch), but received no data (Device likely has empty history).</li> </ul>"},{"location":"WALKTHROUGH/#4-data-decoding-offline","title":"4. Data Decoding (Offline)","text":"<ul> <li>Created <code>csv_decoder.py</code> and <code>analyze_structure.py</code> to analyze the history packets from the CSV.</li> <li>Result:</li> <li>Confirmed History Packet format: 244 bytes.</li> <li>Identified Timestamp periodicity of 13 bytes (mostly).</li> <li>Decoded valid timestamps (e.g., <code>2025-11-12</code>) from the raw hex samples.</li> </ul>"},{"location":"WALKTHROUGH/#conclusion","title":"Conclusion","text":"<p>The protocol is mapped. Authenticated connection and Activation command <code>0x02</code> are confirmed working. The Fetch command <code>01 05 00</code> is consistent with traces, though the empty live device yielded no payload. The data structure is a packed array of records (timestamp + measurements).</p>"}]}